<!-- Name - Ashwin Anand
Student Id - 152042206 -->
<!DOCTYPE html>
<html lang="en">

    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
            integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <link rel="icon"
            href="https://mpng.subpng.com/20180629/ytb/kisspng-computer-icons-clip-art-web-globe-5b35d0b6693359.5423001015302534944309.jpg">
        <title>Hosting Plans | Web Hosting Services</title>
    </head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cabin:wght@600&family=Caveat:wght@600;700&family=IBM+Plex+Sans&family=Poppins&family=Quicksand:wght@400;600&family=Signika+Negative:wght@500&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,600&family=Work+Sans&display=swap');

        .plan {
            background-color: white;
            padding-top: 45px;
            padding-bottom: 70px;
            border: solid #ecebe7 10px;
        }

        .nav-link:hover {
            color: red !important;
        }

        .price {
            color: red;
            font-size: 30px;
            font-weight: bold;
        }

        .plan-details {
            list-style-type: none;
            padding: 0;
            margin-top: 16px;
            text-align: left;
            font-family: sans-serif;
        }

        .in-plan-details {
            margin: 10px;
            font-family: "Quicksand";
        }
    </style>
    <nav class="navbar navbar-expand navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="https://mpng.subpng.com/20180629/ytb/kisspng-computer-icons-clip-art-web-globe-5b35d0b6693359.5423001015302534944309.jpg"
                    alt="" width="50" height="54" class="d-inline-block">
                Web Hosting Services

            </a>

            <div id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" target="new" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/hosting-plans" target="new">Hosting Plans</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard" target="new">Dashboard</a>
                    </li>
                </ul>
            </div>
        </div>

    </nav>
    <style>
        #priceDiv {
            font-size: 30px;
            font-weight: bold;
        }

        .discount {
            color: black;
            background-color: rgb(233, 163, 10);
            text-transform: uppercase;
        }

        .vl {
            border-left: 3px rgb(206, 193, 193) dashed;
            height: 100%;
            margin: 3px 20px;
        }
    </style>

    <body>

        <div style="font-family:Work Sans;">
            <div class="container" style="background-color:rgb(230, 171, 171); text-align:center;  border-radius : 20px; ">
                {{#if resObj.planName}}
                    <div class="row" style="margin-left:20px; margin-right:20px;">
                        <h3 style="text-transform : uppercase;">
                            <i class="fas fa-server" style="color:red;"></i>
                            Web Hosting: WEB {{resObj.planName}}
                        </h3>
                        <div id="originalPrice" data-value="{{resObj.price}}"></div>
                        <div class="col-lg-12 col-md-12"
                            style="background-color:white; padding:20px; border-radius:10px;">
                            <div class="row">
                                <div class="col-md-3">
                                    <div>
                                        <small>3 months</small>
                                        <strong>
                                            <div id="priceDiv" data-value="5.56">$5.56</div>/month
                                        </strong>
                                        <br>
                                        <span class="discount">save 44%</span><br>
                                        <del>${{resObj.price}}</del>
                                    </div>
                                    {{!-- <div class="vl"></div> --}}
                                </div>
                                <div class="col-md-3">
                                    <div>
                                        <small>12 months</small>
                                        <strong>
                                            <div id="priceDiv" data-value="5.00">$5.00</div>/month
                                        </strong>
                                        <br>
                                        <span class="discount">save 50%</span><br>
                                        <del>${{resObj.price}}</del>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div>
                                        <small>24 months</small>
                                        <strong>
                                            <div id="priceDiv" data-value="4.45">$4.45</div>/month
                                        </strong>
                                        <br>
                                        <span class="discount">save 55%</span><br>
                                        <del>${{resObj.price}}</del>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div>
                                        <small>36 months</small>
                                        <strong>
                                            <div id="priceDiv" data-value="3.89">$3.89</div>/month
                                        </strong>
                                        <br>
                                        <span class="discount">save 61%</span><br>
                                        <del>${{resObj.price}}</del>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row" style="margin-top : 20px; margin-left:20px;">
                        <div class="col-md-12">
                            <form method="post"  enctype="application/x-www-form-urlencoded">
                                <div class="row text-danger" id="invalidMonth" style="margin-left:8px;">

                                </div>
                                <div class="row">
                                    <div class="form-group col-md-6 col-sm-12">
                                        <input type="text" id="months" name="months" class="form-control"
                                            placeholder="Enter no of months for the plan of choice: ">
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12">
                                        <input style="width:60%; font-size:18px;" class="form-control btn btn-danger"
                                            type="button" name="submitbtn" onclick="getOrderPrice()"
                                            value="Choose duration">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row" style="margin-left:25%; width:50%;">
                        <div class="col-lg-12 col-md-12"
                            style="background-color:white; border-radius:10px; margin-bottom: 20px; padding: 20px;">
                            <h2>Order Summary</h2>
                            <table
                                style="border: 1px solid rgb(162, 14, 14); width:70%; text-align:center; border-radius:10px; margin-left:15%;">
                                <tr>
                                    <td style="padding:10px; border: 1px solid rgb(162, 14, 14);">WEB
                                        {{resObj.planName}}
                                        <small class="text-muted">(<strong id="nMonths"></strong>)months</small>
                                    </td>
                                    <td id="totalPrice" style="border: 1px solid rgb(162, 14, 14);">$</td>
                                </tr>
                                <tr>
                                    <td style="padding:10px; border: 1px solid rgb(162, 14, 14);">
                                        <span>You Saved</span>
                                    </td>
                                    <td style="border: 1px solid rgb(162, 14, 14);"><strong class="text-danger"
                                            id="savedPrice">$</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:10px; border: 1px solid rgb(162, 14, 14);">
                                        <span>You Pay</span>
                                    </td>
                                    <td style="border: 1px solid rgb(162, 14, 14);"><strong id="finalPrice"
                                            style="font-size:22px;">$</strong>
                                    </td>
                                </tr>
                            </table>
                            <br>
                            <a href="/checkout" style="width:70%; font-size:18px;" class="btn btn-danger"
                                type="button">Checkout Now</a>
                        </div>
                    </div>
                {{else}}
                        <div style="padding:20px; color:Red; margin-top:20%">
                            <h2>Your cart is Empty<br>
                            <a href="/hosting-plans" style="text-decoration:none;">Go shopping!</a></h2>
                        </div>
                {{/if}}
            </div>
        </div>
        <script>
            function fetchFunction(url, method, data) {
                if (data) {
                    return fetch(url,
                        {
                            method: method,
                            headers: { "content-type": "application/json" },
                            body: data
                        }
                    ).then((res) => {
                        return res.json();
                    }).then((json) => {
                        console.log("----------------------");
                        console.log(json);
                        return json;
                    });
                } else {
                    return fetch(url,
                        {
                            method: method,
                            headers: { "content-type": "application/json" }
                        }
                    ).then((res) => {
                        return res.json();
                    }).then((json) => {
                        console.log("----------------------");
                        console.log(json.msg);
                        return json.msg;
                    });

                }

            }



            function getOrderPrice() {
                let originalPrice = document.getElementById("originalPrice").getAttribute("data-value");
                let monthsChosen = document.getElementById("months").value;
                var price = 0;
                var monthValue = "";
                console.log(monthsChosen);
                if (monthsChosen == 3) {
                    price = 5.56;
                }
                else if (monthsChosen == 12) {
                    price = 5.00;
                }
                else if (monthsChosen == 24) {
                    price = 4.45;
                }
                else if (monthsChosen == 36) {
                    price = 3.89;
                }
                else if (monthsChosen == 1) {
                    price = 9.99;
                }
                else {
                    monthValue = "wrong";
                }

                if (!monthValue) {
                    console.log(price);
                    let data = {
                        nMonths: monthsChosen,
                        oPrice: originalPrice,
                        discountedPrice: price
                    }
                    console.log(data);

                    let jsonData = JSON.stringify(data);
                    fetchFunction("/api/ordersummary", "POST", jsonData).then((data) => {
                        console.log(data);
                        document.getElementById("invalidMonth").innerHTML = "";
                        document.getElementById("nMonths").innerHTML = data.nMonths;
                        document.getElementById("totalPrice").innerHTML = "$" + Math.round(data.beforeDiscTotalPrice * 100) / 100;
                        document.getElementById("savedPrice").innerHTML = "$" + Math.round(data.savedPrice * 100) / 100;
                        document.getElementById("finalPrice").innerHTML = "$" + Math.round(data.afterDiscTotalPrice * 100) / 100;
                    });
                }
                else {
                    document.getElementById("invalidMonth").innerHTML = "Please enter correct number of months according to above plans";
                    document.getElementById("nMonths").innerHTML = "";
                    document.getElementById("totalPrice").innerHTML = "$";
                    document.getElementById("savedPrice").innerHTML = "$";
                    document.getElementById("finalPrice").innerHTML = "$";
                }





            }


        </script>
    </body>